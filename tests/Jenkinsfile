pipeline {
  agent {
    node {
      label 'windows-2016'
    }
  }
  stages {
    stage('Run AWS template structure validation tests [Pester]') {
      steps {
        
        s3Upload(bucket: 'pester-tests', includePathPattern: '**/*', workingDir : 'aws')
        script {
            powershell(script: 'Install-Module -Name Pester -Force -SkipPublisherCheck', returnStdout: true)
            response = powershell(script: 'Invoke-Pester "tests/structure"', returnStdout: true)
            echo "Response: ${response}"
        }
      }
    }
  }
}
