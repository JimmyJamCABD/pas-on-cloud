{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": {
        "LambdaDeployRole": {
            "Type": "String"
        }
    },
    "Resources": {
		"DeletePasswordLambda": {
            "Type": "AWS::Lambda::Function",
            "Properties": {
                "Description": "Delete file from s3 bucket",
                "Code": {
                    "ZipFile": {
                        "Fn::Join": [
                            "\n",
                            [
                                "import uuid",
								"import boto3",
								"import cfnresponse",
								"",
								"def DeleteFile(bucket, filePath):",
								"    s3Client = boto3.client('s3', config= boto3.session.Config(signature_version='s3v4'))",
								"    response = s3Client.delete_object(Bucket = bucket, Key = filePath)",
								"    print response",
								"",    
								"def lambda_handler(event, context):",
								"",
								"    physicalResourceId = str(uuid.uuid4())",
								"    if 'PhysicalResourceId' in event:",
								"        physicalResourceId = event['PhysicalResourceId']",
								"    ",
								"    try:",
								"        if event['RequestType'] == 'Create':",
								"            DeleteFile(event['ResourceProperties']['bucket'], event['ResourceProperties']['key'])",
								"            print 'File Deleted'",
								"            return cfnresponse.send(event, context, cfnresponse.SUCCESS, {}, physicalResourceId)",
								"        if event['RequestType'] == 'Delete':",
								"            return cfnresponse.send(event, context, cfnresponse.SUCCESS, {}, physicalResourceId)",
								"",
								"    except Exception as E:",
								"        print E",
								"        return cfnresponse.send(event, context, cfnresponse.FAILED, {}, physicalResourceId)"
                            ]
                        ]
                    }
                },
                "Runtime": "python2.7",
                "Handler": "index.lambda_handler",
                "Role": {
                    "Ref": "LambdaDeployRole"
                }
            }
        }
    },
    "Outputs": {
        "Arn": {
            "Value": { "Fn::GetAtt": ["DeletePasswordLambda", "Arn"] }
        }
    }
}